// plugins/ampify.js

const ampScript =
  '<script async src="https://cdn.ampproject.org/v0.js"></script>'
const customScripts =
  '<script custom-element="amp-sidebar" src="https://cdn.ampproject.org/v0/amp-sidebar-0.1.js" async></script>' +
  '<script custom-element="amp-carousel" src="https://cdn.ampproject.org/v0/amp-carousel-0.2.js" async></script>' +
  '<script async custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>' +
  '<script async custom-element="amp-install-serviceworker" src="https://cdn.ampproject.org/v0/amp-install-serviceworker-0.1.js"></script>'
const ampBoilerplate =
  '<style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>'

module.exports = (html, css) => {
  // Add ⚡ to html tag
  html = html.replace(/<html/gi, '<html ⚡')

  // Remove preload and prefetch tags
  html = html.replace(/<link[^>]*rel="(?:preload|prefetch)?"[^>]*>/gi, '')

  // Remove amphtml tag
  html = html.replace(/<link[^>]*rel="(?:amphtml)?"[^>]*>/gi, '')

  // remove all stylesheet css
  html = html.replace(/<link[^>]*rel="(?:stylesheet)?"[^>]*>/gi, '')

  // remove vue-ssr css
  html = html.replace(
    /<style[^>]*data-vue-ssr[^>]*>(.*?)?<\/style>/gi,
    (match, sub) => {
      return ''
    }
  )

  // custom css
  const customCss = `
    :root{--page-width:480px;--padding-sm:16px;--padding-xs:10px;--color-primary:rgba(0, 0, 0, 0.85);--color-primary-light:#4a4a4a;--color-secondary:#4b80a8;--color-secondary-dark:#1a395a;--color-blue:#2196f3;--color-error:#ff5252;--color-success:#4caf50;--color-warning:#fb8c00;--color-grey-light:rgba(0, 0, 0, .45);--color-grey-dark:rgba(0, 0, 0, .6);--color-primary-bgdark:rgba(255, 255, 255, .92);--color-secondary-bgdark:rgba(255, 255, 255, .6);--bg-header:rgba(9, 57, 94, 0.98);--height-header-alt:40px;--bg-trustpilot:#000032;--color-link-primary:var(--color-secondary);--color-link-primary-hover:var(--color-secondary-dark);--color-link-light:#eee;--color-link-light-hover:#aaa;--color-link-dark:var(--color-primary);--color-link-dark-hover:var(--color-secondary);--border-radius:4px;--border-color:#ddd;--border-color-dark:#aaa;--border-color-light:#eee;--border-color-active:#71bb1b}a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,main,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{border:0;font-size:100%;font:inherit;vertical-align:baseline;margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:after,blockquote:before,q:after,q:before{content:none}table{border-collapse:collapse;border-spacing:0}*{outline:0 none;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html{text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-webkit-tap-highlight-color:transparent}.v-application{font-family:Sans-Serif;font-size:16px;line-height:1.5;background:#f8f8f8;color:var(--color-primary)}#header{position:fixed;width:100%;background:var(--bg-header);box-shadow:0 2px 2px -1px rgba(0,0,0,.2);top:0;right:0;left:0;z-index:5}#header .top{display:flex;padding-top:0;padding-bottom:0;color:var(--color-primary-bgdark);height:var(--height-header-alt);align-items:center;justify-content:space-between}#header .top>.wrap{display:flex;align-items:center}#header .logo{display:flex}#header .bars{position:relative;margin:0 20px 0 -5px;text-align:center;line-height:1;font-size:32px;color:var(--color-primary-bgdark);top:-4px}#header .bars span{display:block;font-size:9px;margin-top:-14px}ul#secondary{display:flex;align-items:center;padding-left:0;height:100%}ul#secondary>li{position:relative;font-size:13px;margin-left:20px}ul#secondary>li .icon{font-size:20px;vertical-align:-4px}#footer{clear:both;background:var(--bg-header);color:var(--color-primary-bgdark);font-size:13px}#footer .bottom{font-size:12px;padding-top:var(--padding-xs);padding-bottom:var(--padding-xs)}#footer .partners .icon{filter:grayscale(90%);color:var(--color-secondary-bgdark);margin-right:4px}#footer .partners .icon.digicert{height:14px;width:60px}#footer .partners .icon.chronopost{height:15px;width:70px}#footer .partners .icon.trustpilot{height:16px;width:60px}#footer .cards{display:inline-flex}#footer .cards .icon{border:solid 1px rgba(255,255,255,.2);padding:2px 4px;margin-right:4px;width:28px;height:18px;border-radius:2px}#sidebar-menu{width:92%;max-width:340px}#sidebar-menu .close{position:absolute;font-size:18px;top:5px;right:10px;z-index:99}#sidebar-menu ul.nav>li{padding-left:var(--padding-sm);padding-right:var(--padding-sm);height:34px;font-size:15px}#sidebar-menu ul.nav>li.header{display:flex;align-items:center;height:40px;text-transform:uppercase;font-weight:600;margin-bottom:var(--padding-xs);border-bottom:solid 1px var(--border-color)}#sidebar-menu ul.nav>li .item{display:flex;align-items:center;justify-content:space-between}#sidebar-menu ul.nav>li .item>span{font-size:24px;line-height:.6}.link,a{color:var(--color-link-primary);text-decoration:none;transition:color .2s ease-in}.link:hover,a:hover{color:var(--color-link-primary-hover)}.link.dark,.lk-dark .link,.lk-dark a,a.dark,ul.prods a{color:var(--color-primary)}.link.dark:hover,.lk-dark .link:hover,.lk-dark a:hover,a.dark:hover,ul.prods a:hover{color:var(--color-primary-hover)}.bg-dark .link,.bg-dark a,.link.light,a.light{color:var(--color-link-light)}.bg-dark .link:hover,.bg-dark a:hover,.link.light:hover,a.light:hover{color:var(--color-link-light-hover)}.link.grey,a.grey{color:var(--color-grey-light)}.link.grey:hover,a.grey:hover{color:var(--color-link-dark-hover)}main.main{position:relative;margin-top:var(--height-header-alt);min-height:300px}.content{width:100%;max-width:var(--page-width);padding:var(--padding-sm);margin-left:auto;margin-right:auto;text-align:justify}.content.fw{padding-left:0;padding-right:0}.content.fw ul.breadcrumbs{padding-left:var(--padding-sm)}.box{background:#fff;box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12)}.box-header{display:flex;align-items:center;justify-content:space-between;position:relative;height:45px;font-size:14px;border-bottom:solid 1px var(--border-color)}.box-title{display:inline;font-size:15px;font-weight:600;line-height:1.1;text-transform:uppercase}.icon{display:inline-flex;align-self:center;height:1em;width:1em;fill:currentColor}.icon.baseline{position:relative;top:.125em}p{margin-bottom:12px}b,strong{font-weight:600}ol,ul{list-style:none}ul.bullet>li:before{content:"•";margin-left:-18px;margin-right:8px;font-size:1.1em;vertical-align:-1px}ul.check>li:before,ul.kp>li:before{content:"✓";margin-left:-18px;margin-right:8px;vertical-align:-1px}ul.nav>li{padding:2px 0;font-size:14px}ul.nav>li .active{font-weight:600;cursor:default;color:var(--color-secondary)}ul.nav>li ul.sub{padding:0 0 4px 15px}ul.nav>li ul.sub>li{padding:2px 0}.display-4,h1{font-size:1.563em;font-weight:600;line-height:1.2;text-align:initial;margin-bottom:.28em}.display-3,h2{font-size:1.425em;font-weight:600;line-height:1.2;text-align:initial;margin-bottom:.28em}.display-2,h3{font-size:1.313em;font-weight:600;line-height:1.3;text-align:initial;margin-bottom:.28em}.display-1,h4{font-size:1.25em;font-weight:600;line-height:1.3;text-align:initial;margin-bottom:.28em}h5,headline{font-size:1.188em;font-weight:600;line-height:1.3;text-align:initial;margin-bottom:.28em}h6,title{font-size:1.125em;font-weight:600;line-height:1.3;text-align:initial;margin-bottom:.28em}.t-bar:after,.t-bar:before{content:"";display:inline-block;height:2px;width:60px;background-color:currentColor;margin:0 6px .2em;opacity:.5}.t-bar:before{width:20px;margin-left:0}ul.breadcrumbs{display:flex;flex-wrap:wrap;font-size:13px;margin-bottom:10px;color:var(--color-grey-dark)}ul.breadcrumbs>li{line-height:1;padding-bottom:6px;white-space:nowrap}ul.breadcrumbs>li .icon{vertical-align:-3px;margin-left:2px}ul.all-brands{column-count:2;column-gap:0;font-size:14px}ul.all-brands>li{padding:4px var(--padding-xs) 4px 0}ul.top-brands-deals{font-size:14px;line-height:1.3}ul.top-brands-deals>li{padding:8px 0;border-top:solid 1px var(--border-color-light)}ul.top-brands-deals>li:first-child{border-top:0}ul.top-brands-deals>li>a{display:flex;align-items:center;justify-content:space-between}ul.top-brands-deals>li>a .wrap{display:flex;align-items:center;width:95%}// somehow it reduces the width of the right arrow when long texts ul.top-brands-deals>li>a .icon{font-size:16px}.nowrap,ul.articles.nowrap,ul.prods.nowrap{flex-wrap:nowrap;justify-content:flex-start;overflow-x:scroll;overflow-y:hidden;scroll-behavior:smooth}.stack{position:relative;color:var(--color-primary-bgdark)}.stack .mask{background:linear-gradient(rgba(0,0,0,.95),rgba(0,0,0,.75))}.stack .mask>img{background:#fff;opacity:.3}.stack .block{position:absolute;width:85%;max-width:960px;text-shadow:1px 1px 2px rgba(45,45,45,.5);top:22%;left:50%;transform:translateX(-50%)}input,select,textarea{font-family:inherit;font-size:15px;border:solid 1px var(--border-color);padding:8px 10px;width:100%;background-color:transparent;max-width:var(--page-width);margin:8px 0;border-radius:var(--border-radius)}input[type=checkbox]{width:auto;vertical-align:-1px}textarea{min-height:110px}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-moz-appearance:textfield}.oneline{display:flex;justify-content:space-between}.oneline>input{width:48%}.btn{display:inline-block;position:relative;font-family:inherit;border:1px solid var(--color-secondary);color:#fff;text-decoration:none;background-color:var(--color-secondary);text-align:center;text-transform:uppercase;font-size:14px;font-weight:600;outline:0;transition:background-color .2s ease-in,color .2s ease-in}.btn.outlined,.btn:not(.outlined):hover{color:var(--color-secondary);background-color:transparent}.btn.outlined:hover{color:#fff;background-color:var(--color-secondary)}.btn.success{color:#fff;border-color:var(--color-success);background-color:var(--color-success)}.btn.success.outlined,.btn.success:not(.outlined):hover{color:var(--color-success);background-color:transparent}input.disabled,select.disabled,textarea.disabled{color:var(--color-grey-light);border-color:var(--border-color);background-color:rgba(0,0,0,.06)}ul.usp{display:flex;flex-wrap:nowrap;justify-content:flex-start}ul.usp>li{display:flex;flex-wrap:nowrap;align-items:center;padding:0 var(--padding-sm);color:var(--color-secondary);font-size:13px;line-height:1.4;white-space:nowrap}ul.usp>li .icn{display:flex;align-items:center;justify-content:center;position:relative;color:var(--color-blue);margin-right:10px;font-size:20px;width:40px;height:40px}ul.usp>li .icn:before{content:"";position:absolute;background:currentColor;border-radius:50%;opacity:.16;bottom:0;left:0;right:0;top:0}ul.usp>li .label .bottom{display:block;font-weight:600}ul.partners,ul.top-brands{display:flex;flex-wrap:nowrap;justify-content:space-between}ul.partners>li,ul.top-brands>li{padding:0 var(--padding-sm);filter:grayscale(100%)}.trustbox .breakdown{display:flex;flex-direction:row;justify-content:center;align-items:center;height:45px;white-space:nowrap;color:#fff;background:var(--bg-trustpilot);width:100%}.trustbox .reputation{display:flex;flex-direction:column;margin-right:12px;font-size:16px;font-weight:600;line-height:1.1;letter-spacing:.5px}.trustbox a{display:block;font-size:11px;font-weight:400;letter-spacing:normal;text-transform:lowercase;color:rgba(255,255,255,.8)}.trustbox .stars{height:24px;width:128px}.trustbox .logo{display:block;margin-left:10px;height:24px;width:98px}ul.prods{display:flex;flex-wrap:wrap}ul.prods>li{flex-basis:50%;max-width:50%;margin-bottom:var(--padding-sm);background-color:#fff;text-align:center;box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12)}ul.prods.grid>li .img{padding:var(--padding-sm)}ul.prods>li .img amp-img{width:100px;height:auto;margin:0 auto}ul.prods.grid>li .details1{padding:5px;transform:scale(.9)}ul.prods.grid>li .details1 .name{display:block;font-size:16px;line-height:1.2;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}ul.prods>li .details1 .brand{display:block;color:var(--color-grey-dark);font-size:13px}ul.prods>li .details1 .rating{display:flex;justify-content:center;font-size:18px;margin-top:4px;height:22px;color:var(--color-success)}ul.prods>li .details1 .rating .count{display:none}ul.prods.grid>li .price{color:var(--color-grey-light);font-size:13px;padding:5px 0 0}ul.prods>li .price .selling{color:var(--color-secondary);font-size:18px}ul.prods.solo>li{margin-bottom:0}ul.prods.grid.nowrap>li,ul.prods.grid.x5.nowrap>li{flex:0 0 40%;max-width:40%}amp-selector[role=tablist].tabs-with-flex{display:flex;flex-wrap:wrap}amp-selector[role=tablist].tabs-with-flex [role=tab]{flex-grow:1;text-align:center;font-size:14px;color:var(--color-grey-dark);text-transform:uppercase;padding:5px var(--padding-xs)}amp-selector[role=tablist].tabs-with-flex [role=tab][selected]{outline:0;border-bottom:2px solid var(--color-secondary);color:var(--color-secondary)}amp-selector[role=tablist].tabs-with-flex [role=tabpanel]{display:none;width:100%;order:1}amp-selector[role=tablist].tabs-with-flex [role=tab][selected]+[role=tabpanel]{display:block}amp-selector[role=tablist].tabs-with-selector{display:flex}amp-selector[role=tablist].tabs-with-selector [role=tab][selected]{outline:0;border-bottom:2px solid var(--color-secondary)}amp-selector[role=tablist].tabs-with-selector{display:flex}amp-selector[role=tablist].tabs-with-selector [role=tab]{width:100%;text-align:center;padding:5px var(--padding-xs)}amp-selector.tabpanels [role=tabpanel]{display:none;padding:var(--padding-sm)}amp-selector.tabpanels [role=tabpanel][selected]{outline:0;display:block}.product .hero{margin:0 auto 20px;max-width:var(--page-width)}.product .col2{font-size:15px}.product .col2 .rating{display:flex;margin:4px 0 12px}.product .col2 .rating .stars{display:flex;font-size:18px;color:var(--color-success)}.product .description ul,.product ul.kp{margin-left:var(--padding-sm);margin-bottom:var(--padding-sm)}.product .deals{padding:10px 12px;font-weight:600;font-size:14px;margin-top:var(--padding-sm);border:solid 1px #d5e9f0;border-radius:var(--border-radius);background:#f3fcff url(/img/assets/confettis.svg) right center no-repeat}.product .detamp select{width:160px}.breakdown-container{border-bottom:solid 1px var(--border-color);color:var(--color-primary-light);padding-bottom:10px;text-align:center}.breakdown-container .rating{font-size:54px;line-height:1.2;font-weight:300}.breakdown-container .stars{font-size:20px}ul.reviews>li{display:flex;flex-wrap:wrap;flex:1 1 auto;font-size:14px;padding:24px 0;border-bottom:1px solid var(--border-color-light);color:var(--color-primary-light)}ul.reviews>li.more{border-bottom:0;justify-content:center}ul.reviews>li .avatar{min-width:70px;margin-bottom:25px}ul.reviews>li .details{min-width:200px;font-size:12px;color:var(--color-grey-light)}ul.reviews>li .details .stars{font-size:14px;color:var(--color-grey-dark)}ul.reviews>li .details .verified{display:block;margin-top:2px;color:var(--color-success)}ul.reviews>li .review{flex:1;min-width:250px}ul.articles{display:flex;flex-wrap:wrap}ul.articles>li{flex-basis:100%;max-width:100%;margin-bottom:var(--padding-sm)}ul.articles>li .card{background:#fff;box-shadow:0 2px 1px -1px rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 1px 3px 0 rgba(0,0,0,.12)}ul.articles>li img{width:100%}ul.articles>li .footer{padding:var(--padding-sm);border-top:solid 1px var(--border-color-light)}ul.articles>li .footer a{display:block;font-size:18px;line-height:1.2;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}ul.articles>li .footer .details{display:flex;align-items:center;flex-wrap:wrap;justify-content:space-between;font-size:12px;margin-top:8px;color:var(--color-grey-dark)}ul.articles>li .footer .details .category{text-transform:uppercase;background:var(--color-secondary);color:#fff;padding:2px 8px;font-size:10px;margin-top:8px;letter-spacing:.2px;border-radius:2px}ul.articles>li .footer .details .by{margin-top:8px}ul.articles.nowrap>li{flex:0 0 90%;max-width:90%}.article{padding-top:12px;padding-bottom:8px;font-size:17px;line-height:1.7}.article ul{margin-bottom:var(--padding-sm)}.pa-0{padding:0}.pa-1{padding:4px}.pa-2{padding:8px}.pa-3{padding:12px}.pa-4{padding:16px}.pa-5{padding:20px}.pa-6{padding:24px}.px-0{padding-right:0;padding-left:0}.px-1{padding-right:4px;padding-left:4px}.px-2{padding-right:8px;padding-left:8px}.px-3{padding-right:12px;padding-left:12px}.px-4{padding-right:16px;padding-left:16px}.px-5{padding-right:20px;padding-left:20px}.px-6{padding-right:24px;padding-left:24px}.py-0{padding-top:0;padding-bottom:0}.py-1{padding-top:4px;padding-bottom:4px}.py-2{padding-top:8px;padding-bottom:8px}.py-3{padding-top:12px;padding-bottom:12px}.py-4{padding-top:16px;padding-bottom:16px}.py-5{padding-top:20px;padding-bottom:20px}.py-6{padding-top:24px;padding-bottom:24px}.pt-0{padding-top:0}.pt-1{padding-top:4px}.pt-2{padding-top:8px}.pt-3{padding-top:12px}.pt-4{padding-top:16px}.pt-5{padding-top:20px}.pt-6{padding-top:24px}.pr-0{padding-right:0}.pr-1{padding-right:4px}.pr-2{padding-right:8px}.pr-3{padding-right:12px}.pr-4{padding-right:16px}.pr-5{padding-right:20px}.pr-6{padding-right:24px}.pb-0{padding-bottom:0}.pb-1{padding-bottom:4px}.pb-2{padding-bottom:8px}.pb-3{padding-bottom:12px}.pb-4{padding-bottom:16px}.pb-5{padding-bottom:20px}.pb-6{padding-bottom:24px}.pl-0{padding-left:0}.pl-1{padding-left:4px}.pl-2{padding-left:8px}.pl-3{padding-left:12px}.pl-4{padding-left:16px}.pl-5{padding-left:20px}.pl-6{padding-left:24px}.ma-0{margin:0}.ma-1{margin:4px}.ma-2{margin:8px}.ma-3{margin:12px}.ma-4{margin:16px}.ma-5{margin:20px}.ma-6{margin:24px}.mx-0{margin-right:0;margin-left:0}.mx-1{margin-right:4px;margin-left:4px}.mx-2{margin-right:8px;margin-left:8px}.mx-3{margin-right:12px;margin-left:12px}.mx-4{margin-right:16px;margin-left:16px}.mx-5{margin-right:20px;margin-left:20px}.mx-6{margin-right:24px;margin-left:24px}.my-0{margin-top:0;margin-bottom:0}.my-1{margin-top:4px;margin-bottom:4px}.my-2{margin-top:8px;margin-bottom:8px}.my-3{margin-top:12px;margin-bottom:12px}.my-4{margin-top:16px;margin-bottom:16px}.my-5{margin-top:20px;margin-bottom:20px}.my-6{margin-top:24px;margin-bottom:24px}.mt-0{margin-top:0}.mt-1{margin-top:4px}.mt-2{margin-top:8px}.mt-3{margin-top:12px}.mt-4{margin-top:16px}.mt-5{margin-top:20px}.mt-6{margin-top:24px}.mr-0{margin-right:0}.mr-1{margin-right:4px}.mr-2{margin-right:8px}.mr-3{margin-right:12px}.mr-4{margin-right:16px}.mr-5{margin-right:20px}.mr-6{margin-right:24px}.mb-0{margin-bottom:0}.mb-1{margin-bottom:4px}.mb-2{margin-bottom:8px}.mb-3{margin-bottom:12px}.mb-4{margin-bottom:16px}.mb-5{margin-bottom:20px}.mb-6{margin-bottom:24px}.ml-0{margin-left:0}.ml-1{margin-left:4px}.ml-2{margin-left:8px}.ml-3{margin-left:12px}.ml-4{margin-left:16px}.ml-5{margin-left:20px}.ml-6{margin-left:24px}.px{padding-left:var(--padding-sm);padding-right:var(--padding-sm)}.body-1{font-size:.1em}.body-2{font-size:.875em}.caption{font-size:.75em}.d-none{display:none}.d-inline{display:inline}.d-inline-block{display:inline-block}.d-block{display:block}.d-flex{display:flex}.d-inline-flex{display:inline-flex}.float-none{float:none}.float-left{float:left}.float-right{float:right}.text-center{text-align:center}.primary--text{color:var(--color-secondary)}.error--text{color:var(--color-error)}.success--text{color:var(--color-success)}.success--warning{color:var(--color-warning)}.grey--text{color:var(--color-grey-light)}.grey-dark--text{color:var(--color-grey-dark)}
  `

  // remove data attributes from tags
  html = html.replace(/\s*data-(?:[^=>]*="[^"]*"|[^=>\s]*)/gi, '')

  // remove JS script tags except for ld+json
  html = html.replace(
    /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
    match => {
      return /application\/ld\+json/gi.test(match) ||
        /custom-element/gi.test(match)
        ? match
        : ''
    }
  )

  // remove inline css
  html = html.replace(/<style[^>]*>.+?<\/style>/gis, '')

  // replace img tags with amp-img
  html = html.replace(/<img([^>]*)>/gi, (match, sub) => {
    return `<amp-img ${sub} layout="intrinsic"></amp-img>` // layout=intrinsic
  })

  // add AMP script before </head>
  html = html.replace(
    '</head>',
    ampScript + customScripts + ampBoilerplate + '</head>'
  )

  // custom css before </head>
  html = html.replace(
    '</head>',
    `<style amp-custom>${customCss}</style></head>`
  )

  return html
}
